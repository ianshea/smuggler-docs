Here’s a tight snapshot of what we’ve put in place, by system—plus the obvious next nibbles.

# Flow / World

- **USmugFlowSubsystem (GameInstanceSubsystem)**
    
    - Phases: `MainMenu, NewGameConfig, InLocation, EndDay`.
        
    - APIs: `BootToMainMenu, StartNewGame, TravelTo(LocationId, EntryTag), ShowEndDay, StartNextDay, RequestTransition`.
        
    - Map handoff: `OpenLevel` with `PendingPhaseAfterLoad` → `HandlePostLoadMap` finishes transition.
        
    - Arrival: teleports pawn to a `PlayerStart` (matches tag if specified).
        
- **USmugLocationDef (PrimaryDataAsset)**
    
    - Fields: `DisplayName`, `Icon`, `PersistentLevel`, `Sublevels`, `EntryPoints (Tag→PlayerStartTag)`, `IntroSequence`, `ExitSequence`.
        
    - Asset Manager registered type `"Location"`.
        
- **Stage triggers** (BP) call Flow APIs to drive the loop.
    
- **Startup policy:** Flow decides phase from the loaded map (so PIE on gameplay map skips menu).
    

# UI / Screens

- **UI Subsystem** already supports: HUD (z=0), screen stack (`PushScreen`, `PopScreen`).
    
- **HUD** spawns via UI subsystem and stays persistent under the stack.
    
- **Main Menu / New Game Config / End Day** screens: PC listens to `OnPhaseChanged` and shows/hides these.
    

# GAS / Player

- **ASC on Player** + `InitAbilityActorInfo` in `BeginPlay`.
    
- **AttributeSet_Vitals**: `Health/MaxHealth`, `Mana/MaxMana` with clamp in `PreAttributeChange`/`PostGameplayEffectExecute`.
    
- **Startup GE** sets/overrides Health/Mana to 100.
    
- **HUD bindings**: delegates for Health/MaxHealth (+ Mana/MaxMana) update progress bars.
    
- **Spell scaffold**: input path and a working ability pattern (CommitAbility/cost/cooldown) tested with prints.
    

# Inventory / Items

- **Stacks use `FPrimaryAssetId`** (legacy `FName` removed).
    
- **Add APIs:**
    
    - `TryAddItemId(PrimaryId, Count, MaxStack)`
        
    - `TryAddContainerItemId(PrimaryId, InstanceGuid)` (non-stackable)
        
- **Stack rule:** any stack with a valid `InstanceGuid` won’t merge (reserved for containers).
    
- **BP helpers**: resolve `PrimaryId → USmugItemDef`, name, icon (sync-load via Asset Manager).
    
- **Asset Manager**: types registered for Items (and now Locations), directories set—name/icon show in UI.
    
- **Pickup flow**: Interact uses `ItemDef->GetPrimaryId()` → `TryAddItemId`; stacking fixed (no GUID on normal items).
    

# Interaction / World items

- **Interact focus & trace** path working (you switched to `BlockAllDynamic`—fine for now).
    
- **Physics** on pickups: solved Nanite/simple collision/mobility gotchas; construction script sets Simulate after mesh set.
    
- **Blueprint `BPI_Smug_Interact`** (and usage) in place for opening screens / adding to inventory.
    

# Build / Modules

- Build.cs includes `"GameplayAbilities","GameplayTags","GameplayTasks","EnhancedInput","UMG","LevelSequence","MovieScene"`.
    
- Fixed UHT error by forward-declaring `ULevelSequence` and adding module deps.
    

---

## What’s intentionally not done yet (queued)

- **Portable containers**: no `PortableBase`, no carry interface/component, no `GA_Carry` yet.
    
- **Stations**: StationBase + StationDef + InventoryTransfer payload hook (still to wire fully).
    
- **Save system**: GUID→ContainerState map not implemented (we only added GUID field & add API).
    
- **Slot components**: snapping Medium containers into vehicles/delivery zones not implemented.
    
- **Checkpoint subsystem**: currently auto-pass via Flow; rules/evaluation TBD.
    
- **Sequences driver**: Flow placeholders only; no `PlaySequence` helper yet.
    
- **Day/Night & Weather**: design docked; subsystems/director not added yet.